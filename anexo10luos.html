<!DOCTYPE html>
<html>
<head>
  <title>Zoneamento Urbanístico - Anexo 10 - LUOS</title>
   <meta charset="utf-8" />
  <script src="https://maps.googleapis.com/maps/api/js" async defer></script>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" type="text/css" href="plugins/Leaflet/dist/leaflet.css"/>
  <script src="plugins/Leaflet/dist/leaflet-src.js" type="text/javascript"></script>

  <script type="text/javascript" src="plugins/Leaflet.GridLayer.GoogleMutant/Leaflet.GoogleMutant.js"></script>

  <script src="http://api-maps.yandex.ru/2.0/?load=package.map&lang=ru-RU" type="text/javascript"></script>
  <script src="plugins/Leaflet-plugins/layer/tile/Yandex.js"></script>

  <script src="plugins/shapefile-js/dist/shp.js" type="text/javascript"></script>
  <script src="plugins/shapefile-js/dist/shp.min.js" type="text/javascript"></script>

  <script src="plugins/leaflet.shapefile-gh-pages/catiline.js" type="text/javascript"></script>
  <script src="plugins/leaflet.shapefile-gh-pages/leaflet.shpfile.js" type="text/javascript"></script>
  <script src="plugins/leaflet.shapefile-gh-pages/shp.js" type="text/javascript"></script>

  <link rel="stylesheet" href="bootstrap/dist/css/bootstrap.css" />
  <link rel="stylesheet" href="bootstrap/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="bootstrap/dist/css/bootstrap-theme.css" />
  <link rel="stylesheet" href="bootstrap/dist/css/bootstrap-theme.min.css" />
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/style-responsive.css" />
  <link rel="shortcut icon" href="http://iplan.santamaria.rs.gov.br/img/favicon.ico" />

  <link rel="stylesheet" href="plugins/Leaflet.draw/docs/libs/leaflet.css"/>
  <link rel="stylesheet" href="plugins/Leaflet.draw/dist/leaflet.draw.css"/>

  <script src="plugins/Leaflet.draw/docs/libs/libs/leaflet-src.js"></script>

  <script src="plugins/Leaflet.draw/src/Leaflet.draw.js"></script>
  <script src="plugins/Leaflet.draw/src/Leaflet.Draw.Event.js"></script>

  <script src="plugins/Leaflet.draw/src/Toolbar.js"></script>
  <script src="plugins/Leaflet.draw/src/Tooltip.js"></script>

  <script src="plugins/Leaflet.draw/src/ext/GeometryUtil.js"></script>
  <script src="plugins/Leaflet.draw/src/ext/LatLngUtil.js"></script>
  <script src="plugins/Leaflet.draw/src/ext/LineUtil.Intersect.js"></script>
  <script src="plugins/Leaflet.draw/src/ext/Polygon.Intersect.js"></script>
  <script src="plugins/Leaflet.draw/src/ext/Polyline.Intersect.js"></script>
  <script src="plugins/Leaflet.draw/src/ext/TouchEvents.js"></script>

  <script src="plugins/Leaflet.draw/src/draw/DrawToolbar.js"></script>
  <script src="plugins/Leaflet.draw/src/draw/handler/Draw.Feature.js"></script>
  <script src="plugins/Leaflet.draw/src/draw/handler/Draw.SimpleShape.js"></script>
  <script src="plugins/Leaflet.draw/src/draw/handler/Draw.Polyline.js"></script>
  <script src="plugins/Leaflet.draw/src/draw/handler/Draw.Circle.js"></script>
  <script src="plugins/Leaflet.draw/src/draw/handler/Draw.Marker.js"></script>
  <script src="plugins/Leaflet.draw/src/draw/handler/Draw.Polygon.js"></script>
  <script src="plugins/Leaflet.draw/src/draw/handler/Draw.Rectangle.js"></script>


  <script src="plugins/Leaflet.draw/src/edit/EditToolbar.js"></script>
  <script src="plugins/Leaflet.draw/src/edit/handler/EditToolbar.Edit.js"></script>
  <script src="plugins/Leaflet.draw/src/edit/handler/EditToolbar.Delete.js"></script>

  <script src="plugins/Leaflet.draw/src/Control.Draw.js"></script>

  <script src="plugins/Leaflet.draw/src/edit/handler/Edit.Poly.js"></script>
  <script src="plugins/Leaflet.draw/src/edit/handler/Edit.SimpleShape.js"></script>
  <script src="plugins/Leaflet.draw/src/edit/handler/Edit.Circle.js"></script>
  <script src="plugins/Leaflet.draw/src/edit/handler/Edit.Rectangle.js"></script>
  <script src="plugins/Leaflet.draw/src/edit/handler/Edit.Marker.js"></script>

  <script src="plugins/togeojson/togeojson.js" type="text/javascript"></script>
  <script src="plugins/leaflet.FileLayer/src/leaflet.filelayer.js" type="text/javascript"></script>

  <style>
  #map {
/*    margin: 32px; */
/*    width: auto; */
/*    overflow: visible; */
    width: calc( 100vw - 64px );
    height: calc( 100vh - 60px );
  }
  body { margin: 0 }

  </style>
</head>
<body>

<section id="container" class="">
    <header class="header iplan-bg">
      <div class="toggle-nav">
        <div class="icon-reorder tooltips" data-original-title="Toggle Navigation" data-placement="bottom"><i class="icon_menu"></i>
        </div>
      </div>


      <div class="top-nav notification-row">                
        <ul class="nav pull-right top-menu">
          <li> <a href="index.html">Início</a> </li>
          <li><a href="fichatecnica.html">Ficha Técnica</a></li>
        </ul>
      </div>
    </header>

   <section id="main-content">
    <section class="wrapper">
      <div class="row">
        <div id="map" class="map"></div>
      </div>
    </section>
  </section>
  <script type="text/javascript">

    var mapopts =  {
//      zoomSnap: 0.1
    };

    var map = L.map('map', mapopts).setView([0,0],0);

    var bounds = new L.LatLngBounds(
      new L.LatLng(-29.62,-53.94),
      new L.LatLng(-29.80,-53.67));

    map.fitBounds(bounds);

    var roadMutant = L.gridLayer.googleMutant({
      maxZoom: 24,
      type:'roadmap'
    }).addTo(map);

    var satMutant = L.gridLayer.googleMutant({
      maxZoom: 24,
      type:'satellite'
    });

    var osm = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
        '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a> '
  });
    var yndx = new L.Yandex();
    var landmap= L.tileLayer('http://{s}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: 'Map data &copy; <a href="http://thunderforest.com/">Thunderforest</a> contributors, '
    });
    var wmsLayer= L.tileLayer.wms('http://demo.opengeo.org/geoserver/ows?', {
    layers: 'nasa:bluemarble'
    });


    var popup = L.popup();

      function onMapClick(e) {
          popup
          .setLatLng(e.latlng)
          .setContent("Coordenadas do ponto: " + e.latlng.toString())
          .openOn(map);
        }

          map.on('click', onMapClick);
   
    function getColor(d) {
      return d =='A'  ? '#cc00ff' :
          d =='B'   ? '#ff0000' :
          d =='C'   ? '#ffb3b3' :
          d =='D'   ? '#ccff66' :
          d =='E'   ? '#ff9933' :
          d =='F'   ? '#e6ffcc' :
          d =='G'   ? '#99ff66' :
          d =='H'   ? '#66ff66' :
              '#000000';
  }
    function style(feature) {
      return {
        weight: 0.5,
        opacity: 1,
        color: 'black',
        dashArray: '0',
        fillOpacity: 0.5,
        fillColor: getColor(feature.properties.MACROZONA)
    };
  }

  var geo = L.geoJson({features:[], style: style},{onEachFeature:function popUp(f,l){
        var popupContent="<div><img src='parakmz.png'></img></div><br/>";
        var titulo="<div><b>Zoneamento Anexo 10 -LUOS</b></div><br/>";

        var out = [];
        if (f.properties){
            for(var key in f.properties){
              if (key=='ZONA'){
                var nomelabel=f.properties[key];
                l.bindTooltip("IPLAN - Zona "+nomelabel, {persistent:true });
              }
              if (key=='MACROZONA'){
                out.push("Macrozona: "+f.properties[key]);
              }
              else if (key=='DESC_MAC'){
                out.push("Descrição: "+f.properties[key]);
              }
              else if (key=='ZONA'){
                out.push("Zona: "+f.properties[key]);
              }
              else if (key=='IA_MAX'){
                out.push("Indice de aproveitamento (IA - máximo): "+f.properties[key]);
              }
              else if (key=='OBS_IA'){
                out.push("Observação (IA): "+f.properties[key]);
              }
              else if (key=='IO_MAX'){
                out.push("Índice de ocupação (IO - máximo): "+f.properties[key]);
              }
              else if (key=='ALTURA'){
                out.push("Altura: "+f.properties[key]);
              }
              else if (key=='SUPERF_MIN'){
                out.push("Superficie Mínima: "+f.properties[key]);
              }
              else if (key=='TESTADA_MN'){
                out.push("Testada Mínima: "+f.properties[key]);
              }
              else if (key=='REL_MAX_TE'){
                out.push("Relação Máxima Testada / Compr. dos lotes: "+f.properties[key]);
              }
              else if(key=='Shape_Leng'){
                out.push();
              }
              else if(key=='Shape_Area'){
                out.push();
              }
              else{
                out.push(key+": "+f.properties[key]);
              }
        }
        l.bindPopup(popupContent +titulo+ out.join("<br />"));
    }
  }}).addTo(map);

  var base = 'zoneamento.zip';
    shp(base).then(function(data){
    geo.addData(data);
    geo.setStyle(style);
    });

  var baseMaps = {
      'Google Estradas': roadMutant,
      'Google Satélite': satMutant,
      'Landscape': landmap,
      'NASA': wmsLayer,
      'Open Street Map': osm,
      'Yandex (Rússia)':yndx,
  };

  var overlayMaps = {
    'Zoneamento Anexo 10':geo,
  };

  L.control.layers(baseMaps, overlayMaps, {collapsed: false
    }).addTo(map);

  var drawnItems = new L.FeatureGroup();
    map.addLayer(drawnItems);

    var drawControl = new L.Control.Draw({
        position: 'topleft',
        draw: {
            polyline: true,
            polygon: true,
            circle: true,
            marker: true
        },
        edit: {
            featureGroup: drawnItems,
            remove: true
        }
    });
    map.addControl(drawControl);

    map.on(L.Draw.Event.CREATED, function (e) {
        var type = e.layerType,
                layer = e.layer;

        if (type === 'marker') {
            layer.bindPopup('Marcador Criado!');
        }

        drawnItems.addLayer(layer);
    });

    map.on(L.Draw.Event.EDITED, function (e) {
        var layers = e.layers;
        var countOfEditedLayers = 0;
        layers.eachLayer(function (layer) {
            countOfEditedLayers++;
        });
        console.log("Edited " + countOfEditedLayers + " layers");
    });

    L.DomUtil.get('changeColor').onclick = function () {
        drawControl.setDrawingOptions({rectangle: {shapeOptions: {color: '#004a80'}}});
    };


  </script>
</body>
</html>
