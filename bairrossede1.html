<!DOCTYPE html>
<html>
<head>
  <title>Zoneamento Urbanístico - Anexo 10 LUOS </title>
   <meta charset="utf-8" />
  <script src="https://maps.googleapis.com/maps/api/js" async defer></script>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

<!--  <link rel="stylesheet" href="../Leaflet/dist/leaflet.css" />
  <script type="text/javascript" src="../Leaflet/dist/leaflet-src.js"></script>-->

  <link rel="stylesheet" type="text/css" href="plugins/Leaflet/dist/leaflet.css"/>
  <script src="plugins/Leaflet/dist/leaflet-src.js" type="text/javascript"></script>

  <script type="text/javascript" src="plugins/Leaflet.GridLayer.GoogleMutant/Leaflet.GoogleMutant.js"></script>

  <script src="http://api-maps.yandex.ru/2.0/?load=package.map&lang=ru-RU" type="text/javascript"></script>
  <script src="plugins/Leaflet-plugins/layer/tile/Yandex.js"></script>

  <script src="plugins/shapefile-js/dist/shp.js" type="text/javascript"></script>
  <script src="plugins/shapefile-js/dist/shp.min.js" type="text/javascript"></script>

  <script src="plugins/leaflet.shapefile-gh-pages/catiline.js" type="text/javascript"></script>
  <script src="plugins/leaflet.shapefile-gh-pages/leaflet.shpfile.js" type="text/javascript"></script>
  <script src="plugins/leaflet.shapefile-gh-pages/shp.js" type="text/javascript"></script>

  <link rel="stylesheet" href="bootstrap/dist/css/bootstrap.css" />
  <link rel="stylesheet" href="bootstrap/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="bootstrap/dist/css/bootstrap-theme.css" />
  <link rel="stylesheet" href="bootstrap/dist/css/bootstrap-theme.min.css" />
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/style-responsive.css" />
  <link rel="shortcut icon" href="http://iplan.santamaria.rs.gov.br/img/favicon.ico" />

  <link rel="stylesheet" href="plugins/Leaflet.draw/docs/libs/leaflet.css"/>
  <link rel="stylesheet" href="plugins/Leaflet.draw/dist/leaflet.draw.css"/>

  <script src="plugins/Leaflet.draw/docs/libs/libs/leaflet-src.js"></script>

  <script src="plugins/Leaflet.draw/src/Leaflet.draw.js"></script>
  <script src="plugins/Leaflet.draw/src/Leaflet.Draw.Event.js"></script>

  <script src="plugins/Leaflet.draw/src/Toolbar.js"></script>
  <script src="plugins/Leaflet.draw/src/Tooltip.js"></script>

  <script src="plugins/Leaflet.draw/src/ext/GeometryUtil.js"></script>
  <script src="plugins/Leaflet.draw/src/ext/LatLngUtil.js"></script>
  <script src="plugins/Leaflet.draw/src/ext/LineUtil.Intersect.js"></script>
  <script src="plugins/Leaflet.draw/src/ext/Polygon.Intersect.js"></script>
  <script src="plugins/Leaflet.draw/src/ext/Polyline.Intersect.js"></script>
  <script src="plugins/Leaflet.draw/src/ext/TouchEvents.js"></script>

  <script src="plugins/Leaflet.draw/src/draw/DrawToolbar.js"></script>
  <script src="plugins/Leaflet.draw/src/draw/handler/Draw.Feature.js"></script>
  <script src="plugins/Leaflet.draw/src/draw/handler/Draw.SimpleShape.js"></script>
  <script src="plugins/Leaflet.draw/src/draw/handler/Draw.Polyline.js"></script>
  <script src="plugins/Leaflet.draw/src/draw/handler/Draw.Circle.js"></script>
  <script src="plugins/Leaflet.draw/src/draw/handler/Draw.Marker.js"></script>
  <script src="plugins/Leaflet.draw/src/draw/handler/Draw.Polygon.js"></script>
  <script src="plugins/Leaflet.draw/src/draw/handler/Draw.Rectangle.js"></script>


  <script src="plugins/Leaflet.draw/src/edit/EditToolbar.js"></script>
  <script src="plugins/Leaflet.draw/src/edit/handler/EditToolbar.Edit.js"></script>
  <script src="plugins/Leaflet.draw/src/edit/handler/EditToolbar.Delete.js"></script>

  <script src="plugins/Leaflet.draw/src/Control.Draw.js"></script>

  <script src="plugins/Leaflet.draw/src/edit/handler/Edit.Poly.js"></script>
  <script src="plugins/Leaflet.draw/src/edit/handler/Edit.SimpleShape.js"></script>
  <script src="plugins/Leaflet.draw/src/edit/handler/Edit.Circle.js"></script>
  <script src="plugins/Leaflet.draw/src/edit/handler/Edit.Rectangle.js"></script>
  <script src="plugins/Leaflet.draw/src/edit/handler/Edit.Marker.js"></script>

  <script src="plugins/togeojson/togeojson.js" type="text/javascript"></script>
  <script src="plugins/leaflet.FileLayer/src/leaflet.filelayer.js" type="text/javascript"></script>

  <style>
  #map {
/*    margin: 32px; */
/*    width: auto; */
/*    overflow: visible; */
    width: calc( 100vw - 64px );
    height: calc( 100vh - 60px );
  }
  body { margin: 0 }

  </style>
</head>
<body>

<section id="container" class="">
    <header class="header iplan-bg">
      <div class="toggle-nav">
        <div class="icon-reorder tooltips" data-original-title="Toggle Navigation" data-placement="bottom"><i class="icon_menu"></i>
        </div>
      </div>


      <div class="top-nav notification-row">                
        <ul class="nav pull-right top-menu">
          <li> <a href="index.html">Início</a> </li>
          <li><a href="fichatecnica.html">Ficha Técnica</a></li>
        </ul>
      </div>
    </header>

   <section id="main-content">
    <section class="wrapper">
      <div class="row">
        <div id="map" class="map"></div>
      </div>
    </section>
  </section>
        <script type="text/javascript">

    var mapopts =  {
//      zoomSnap: 0.1
    };

    var map = L.map('map', mapopts).setView([0,0],0);

    var bounds = new L.LatLngBounds(
      new L.LatLng(-29.62,-53.94),
      new L.LatLng(-29.80,-53.67));

    map.fitBounds(bounds);

    var roadMutant = L.gridLayer.googleMutant({
      maxZoom: 24,
      type:'roadmap'
    }).addTo(map);

    var satMutant = L.gridLayer.googleMutant({
      maxZoom: 24,
      type:'satellite'
    });

    var osm = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
        '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a> '
  });
    var yndx = new L.Yandex();
    var landmap= L.tileLayer('http://{s}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: 'Map data &copy; <a href="http://thunderforest.com/">Thunderforest</a> contributors, '
    });
    var wmsLayer= L.tileLayer.wms('http://demo.opengeo.org/geoserver/ows?', {
    layers: 'nasa:bluemarble'
    });


    var popup = L.popup();

      function onMapClick(e) {
          popup
          .setLatLng(e.latlng)
          .setContent("Coordenadas do ponto: " + e.latlng.toString())
          .openOn(map);
        }

          map.on('click', onMapClick);
   
    function getColor(d) {
      return d =='4316907025'  ? '#ff794d' :
            d =='4316907026'   ? '#fff2e6' :
            d =='4316907027'   ? '#ffe6cc' :
            d =='4316907028'   ? '#ffd9b3' :
            d =='4316907023'   ? '#ffcc99' :
            d =='4316907029'   ? '#ffbf80' :
            d =='4316907021'   ? '#ffb366' :
            d =='4316907001'   ? '#ffa64d' :
            d =='4316907013'   ? '#ff9933' :
            d =='4316907007'   ? '#ff8c1a' :
            d =='4316907043'   ? '#ff8000' :
            d =='4316907031'   ? '#e67300' :
            d =='4316907032'   ? '#ff8000' :
            d =='4316907030'   ? '#e67300' :
            d =='4316907009'   ? '#fff2e6' :
            d =='4316907011'   ? '#ffe6cc' :
            d =='4316907018'   ? '#ffd9b3' :
            d =='4316907033'   ? '#ffcc99' :
            d =='4316907034'   ? '#ffbf80' :
            d =='4316907038'   ? '#ffb366' :
            d =='4316907002'   ? '#ffa64d' :
            d =='4316907037'   ? '#ff6600' :
            d =='4316907004'   ? '#e65c00' :
            d =='4316907003'   ? '#fff0e6' :
            d =='4316907008'   ? '#ffe0cc' :
            d =='4316907005'   ? '#ffd1b3' :
            d =='4316907035'   ? '#ffc299' :
            d =='4316907036'   ? '#ffb380' :
            d =='4316907016'   ? '#ffa366' :
            d =='4316907022'   ? '#ff944d' :
            d =='4316907010'   ? '#ff8533' :
            d =='4316907019'   ? '#ff751a' :
            d =='4316907017'   ? '#fff2e6' :
            d =='4316907039'   ? '#ffe6cc' :
            d =='4316907006'   ? '#ffd9b3' :
            d =='4316907012'   ? '#ffcc99' :
            d =='4316907040'   ? '#ffbf80' :
            d =='4316907041'   ? '#ffb366' :
            d =='4316907015'   ? '#ffa64d' :
            d =='4316907014'   ? '#ff9933' :
            d =='4316907042'   ? '#ff8c1a' :
            d =='4316907044'   ? '#e67300' :

                    '#000000';
  }
    function style(feature) {
      return {
        weight: 0.5,
        opacity: 1,
        color: 'black',
        dashArray: '0',
        fillOpacity: 0.5,
        fillColor: getColor(feature.properties.GEOCODIGO)
    };
  }

  var geo = L.geoJson({features:[], style: style},{onEachFeature:function popUp(f,l){
        var popupContent="<div><img src='parakmz.png'></img></div><br/>";
        var titulo="<div><b>Unidades de Vizinhança - 1° Distrito Sede</b></div><br/>";

        var out = [];
        if (f.properties){
            for(var key in f.properties){
              if (key=='NOME'){
                var nomelabel=f.properties[key];
                l.bindTooltip("IPLAN - Bairro "+nomelabel, {persistent:true });
              }
              if (key=='OBJECTID'){
                out.push();
              }
              else if (key=='CD_GEOCODS'){
                out.push();
              }
              else if (key=='CD_GEOCODB'){
                out.push();
              }
              else if (key=='GEOCODIGO'){
                out.push();
              }
              else if (key=='NOME'){
                out.push("Nome: "+f.properties[key]);
              }
              else if (key=='LAREAHA'){
                out.push("Área (Legislação -ha): "+f.properties[key]);
              }
              else if (key=='LAREAKM2'){
                out.push("Área (Legislação -km²): "+f.properties[key]);
              }
              else if (key=='LPERIMK'){
                out.push("Perímetro (Legislação -km): "+f.properties[key]);
              }
              else if (key=='LPERIMM'){
                out.push("Perímetro (Legislação -m): "+f.properties[key]);
              }
              else if(key=='Shape_len'){
                out.push();
              }
              else if(key=='Shape_area'){
                out.push();
              }
              else{
                out.push(key+": "+f.properties[key]);
              }
        }
        l.bindPopup(popupContent + titulo + out.join("<br />"));
    }
  }}).addTo(map);

  var base = 'bairros.zip';
    shp(base).then(function(data){
    geo.addData(data);
    geo.setStyle(style);
    });

  var baseMaps = {
      'Google Estradas': roadMutant,
      'Google Satélite': satMutant,
      'Landscape': landmap,
      'NASA': wmsLayer,
      'Open Street Map': osm,
      'Yandex (Rússia)':yndx,
  };

  var overlayMaps = {
    'Bairros':geo,
  };

  L.control.layers(baseMaps, overlayMaps, {collapsed: false
    }).addTo(map);

  var drawnItems = new L.FeatureGroup();
    map.addLayer(drawnItems);

    var drawControl = new L.Control.Draw({
        position: 'topleft',
        draw: {
            polyline: true,
            polygon: true,
            circle: true,
            marker: true
        },
        edit: {
            featureGroup: drawnItems,
            remove: true
        }
    });
    map.addControl(drawControl);

    map.on(L.Draw.Event.CREATED, function (e) {
        var type = e.layerType,
                layer = e.layer;

        if (type === 'marker') {
            layer.bindPopup('Marcador Criado!');
        }

        drawnItems.addLayer(layer);
    });

    map.on(L.Draw.Event.EDITED, function (e) {
        var layers = e.layers;
        var countOfEditedLayers = 0;
        layers.eachLayer(function (layer) {
            countOfEditedLayers++;
        });
        console.log("Edited " + countOfEditedLayers + " layers");
    });

    L.DomUtil.get('changeColor').onclick = function () {
        drawControl.setDrawingOptions({rectangle: {shapeOptions: {color: '#004a80'}}});
    };


  </script>
</body>
</html>
